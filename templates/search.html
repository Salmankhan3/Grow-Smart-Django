{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrowSmart.com</title>
    <link rel="stylesheet" href="{%static 'style.css'%}">
    
    <script src="https://kit.fontawesome.com/a18ae6822d.js" crossorigin="anonymous"></script>
<style>
/* ---- Search Header ---- */
.search-header {
  text-align: center;
  margin: 60px auto 30px;
}
.search-header h2 {
  font-size: 36px;
  font-weight: bold;
  color: #2c3e50;
  margin-bottom: 10px;
}
.results-count {
  font-size: 18px;
  color: #6c757d;
  margin-top: 5px;
}

/* ---- No Results ---- */
.no-results {
  text-align: center;
  margin: 60px auto;
  color: #555;
}
.no-results img {
  width: 60px;
  margin-bottom: 20px;
  opacity: 0.7;
}
.no-results p {
  font-size: 20px;
  margin-bottom: 20px;
}
.btn-back {
  display: inline-block;
  background-color: #5cb85c;
  color: white;
  padding: 10px 25px;
  font-size: 16px;
  text-decoration: none;
  border-radius: 30px;
  transition: background-color 0.3s ease;
}
.btn-back:hover {
  background-color: #449d44;
}
</style>
</head>
<body>
  <a id="top-section" ></a>
  <header>
    <div class="navbar">
      <div class="nav-logo">
        <a href="index">
            <div class="logo border"></div>
            </a>
      </div>
      
        <form name='search' class='search' action="{% url 'search'%}" method='GET'>
         <div class="search-bar">
            <select class="search-select" name="category">
                <option>All</option>
                <option value="fruit">Fruits</option>
                <option value="Vegetable">Vegetables</option>
                <option value="seeds">Seeds</option>
                <option value="Dryfruit">Dryfruit</option>
            </select>
            <input placeholder="Search" class="search-input" name='keyword'>
            <div class="search-icon">
            <button type="submit" class="search-btn" style="width: 35px; height: 35px; background-color:  rgb(240, 240, 67);  border: none; font-size:20px">
             <i class="fa-solid fa-magnifying-glass"></i>
            </button>
           </div>

        </div>
    </form>
    <div class="sell_product">
     <a href='addproduct'> Sell</a>
    </div>
        <div class='tracker'>
        <a href='tracker'>Tracker</a>  
        </div>
        <div class="login">
        <a href="login" target="_blank">Login</a>
        </div>
        <div class="regester">
        <a href="regester" target="_blank">Register</a>
        </div>
        <div class="cart">
        <div class="icon"><i class="fa-solid fa-cart-shopping"></i> 
        <a href="cart" target="_blank">  Cart </a>
        </div>
        </div>
        </div>
    </header>
    <div class="hero-section">
    <div class="image"><img src="{% static 'images/Fresh-Food_7a9e8440-2c83-4b51-820c-72fa7aa49498.webp'%}" id="m1"></div>
    <div id="text"><a>You are on Grow Smart.com enjoy your Shoping</a></div>
    </div>
  </div>
 <!-- Search Result Heading -->
    <div class="search-header">
      <h2>Search Results</h2>
      <p class="results-count">{{ product_count }} item{{ product_count|pluralize }} found</p>
    </div>
<div class="shop-section">

   
    <!-- Product List -->
    {% if products %}
      {% for product in products %}
        <div class="box box{{ forloop.counter }}" onclick="window.location.href='{% url 'productdisplay' product.id %}'">
          <div class="box-content">
            <div class="box-img" style="background-image: url('{{ product.image.url }}');"></div>
            <p class="product-name">{{ product.name }}</p>
            <p id="price">Rs. {{ product.price }}</p>
          </div>
          <div class="add-to-cart">
            <div class="tooltip">
              <i class="fa-solid fa-cart-shopping add-to-cart-icon"
                 onclick="event.stopPropagation(); window.location.href='{% url 'add_carts' product.id %}'"
                 style="cursor:pointer;"></i>
              <span class="tooltip-text">Add to Cart</span>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <!-- No Products Found -->
      <div class="no-results">
        <img src="{% static 'images/download.png' %}" alt="No results" />
        <p>No products found for "<strong>{{ request.GET.keyword }}</strong>"</p>
        <a href="{% url 'index' %}" class="btn-back">Continue Shopping</a>
      </div>
    {% endif %}
</div>


<footer>
    <div class="navfooterbacktotoptext">
        <a href="#top-section"><p>Back to top</p></a> 
    </div>
    <div class="foot-panel2">
      <ul>
        <p>Contact Details</p>
        <a> <i class="fa-solid fa-location-dot"></i> Ring road peshawar</a>
        <a>
       <a><i class="fa-solid fa-phone">(092)3189398866</i> </a>
        <a>Customer Support: 7 Days a Week, 9:00am - 10:00pm </a>
        <div class="social-media">
  <a href="https:\\www.facebook.com" class="fa-facebook social-m"><i class="fa-brands fa-facebook"></i></a>
  <a href="https:\\www.instagram.com"class="instagram social-m"><i class="fa-brands fa-instagram"></i></a>
  <a href="https:\\www.youtube.com"  class="youtube social-m"><i class="fa-brands fa-youtube"></i></a>
  <a href="https:\\www.tiktok.com"   class="tiktok social-m"><i class="fa-brands fa-tiktok"></i>
        </a>
        </div>
      </ul>
<ul>	
<p>Customer Services</p>
<a href="index.html" class="contact">
  Contact Us
  <span class="hover-text">Contact Us</span>
</a>

<a>FAQs</a>
</ul>
<ul>
<p>Information</p>
<a>Return & Refund</a>
<a>Privacy Policy</a>
<a>Terms & Conditions </a>
</ul>
<ul>
<p>Subscribe our Newsletter</p>
<a>Get the latest offers and promotions!</a>
<div class="Newsletter">
<input placeholder="Enter your Email" class="email" >
<div class="Subscribe"><a href="Subscibe">Subscibe</a></div>
</div>
</ul>
</div>
<div class="foot-panel3">
<a href="index.html" class="logo2"></a>
</div>
<div class="foot-panel4">
 <div class="pages">
<a> Conditions of Use</a>
<a>Privacy Notice</a>
<a>Consumer Health Data Privacy Disclosure</a>
<a>Your Ads Privacy Choices</a>
 </div>
 <div class="copyright"> 
  Â© 2024-2025,Grow smart.com, Inc. All Right reserved
 </div>
</div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const searched = {{ searched|yesno:"true,false" }}; // comes from Django

  if (!searched) {
    const container = document.querySelector('.shop-section');
    const products = JSON.parse(localStorage.getItem('userProducts')) || [];

    products.forEach((product, index) => {
      const box = document.createElement('div');
      box.className = 'box';
      box.onclick = () => {
        const query = `productpage.html?name=${encodeURIComponent(product.name)}&price=${product.price}&image=${encodeURIComponent(product.image)}`;
        window.location.href = query;
      };
      box.innerHTML = `
        <div class="box-img" style="background-image: url('${product.image}');"></div>
        <p class="product-name" style="color: #170388;font-weight: 600;font-size: 15px; margin-left: 10px">${product.name}</p>
        <p id="price" style="margin-top: 24px;color: #2D2E2Efc; font-weight:600; margin-left: 10px">Rs. ${product.price}</p>
        <div class="add-to-cart">
          <div class="tooltip">
            <i class="fa-solid fa-cart-shopping add-to-cart-icon"></i>
            <span class="tooltip-text">Add to Cart</span>
          </div>
        </div>
      `;
      container.appendChild(box);
    });

    const addtocart_btns = document.querySelectorAll(".add-to-cart-icon");
    addtocart_btns.forEach(btn => {
      btn.addEventListener("click", (event) => {
        event.stopPropagation();

        const box = btn.closest(".box");
        const name = box.querySelector(".product-name").innerText;
        const priceText = box.querySelector("#price").innerText;
        const price = priceText.split(" ")[1];
        const bgImageStyle = box.querySelector(".box-img").style.backgroundImage;
        const imageUrl = bgImageStyle.slice(5, -2);
        const imageurl2 = "http://127.0.0.1:8000/" + imageUrl;

        const product = {
          name,
          price,
          quantity: 1,
          image: imageurl2,
          subtotal: Number(price),
        };

        const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
        cartItems.push(product);
        localStorage.setItem("cartItems", JSON.stringify(cartItems));
        alert("Item added successfully");
      });
    });
  }
});

// logic for chat bot
  const chatIcon = document.getElementById('chatbot-icon');
  const chatbotWindow = document.getElementById('chatbot-window');

  chatIcon.addEventListener('click', () => {
    chatbotWindow.style.display = chatbotWindow.style.display === 'none' || chatbotWindow.style.display === '' 
      ? 'block' 
      : 'none';
        });
</script>
</body>
</html>